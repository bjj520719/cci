# 创建工作负载<a name="cci_01_0011"></a>

工作负载是对Pod的服务化封装，包括无状态负载（Deployment）。一个工作负载可以包含多个Pod，其中无状态负载中的所有Pod都相同，且您不需要保存负载的状态或持久化的数据。

无状态负载与Kubernetes中Deployment Workloads的定义方式相同，是对Pod的服务化封装。一个无状态负载可以包含一个或多个Pod副本，每个Pod副本的角色相同，所以系统会自动为无状态负载的多个Pod副本分发请求。同一无状态负载的所有Pod副本共享存储卷。

## 创建负载<a name="section18340744132615"></a>

1.  登录云容器实例管理控制台，左侧导航栏中选择“工作负载“，在右侧页面中选择命名空间，单击“创建负载“。
2.  添加Pod中的容器。
    1.  选择需要部署的镜像。
        -   我的镜像：展示了您上传到容器镜像服务的镜像。
        -   Docker官方镜像：展示了Dockerhub上的公共镜像。

    2.  配置镜像参数。

        **表 1**  镜像参数说明

        <a name="table128216444815"></a>
        <table><thead align="left"><tr id="row0282348486"><th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.1.1"><p id="p3282147483"><a name="p3282147483"></a><a name="p3282147483"></a>参数</p>
        </th>
        <th class="cellrowborder" valign="top" width="77%" id="mcps1.2.3.1.2"><p id="p1828244144819"><a name="p1828244144819"></a><a name="p1828244144819"></a>说明</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row48048642214"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p880613615224"><a name="p880613615224"></a><a name="p880613615224"></a>镜像版本</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p08061166224"><a name="p08061166224"></a><a name="p08061166224"></a>选择镜像的版本。</p>
        </td>
        </tr>
        <tr id="row32839494813"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p122831140486"><a name="p122831140486"></a><a name="p122831140486"></a>容器名称</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p528314415486"><a name="p528314415486"></a><a name="p528314415486"></a>容器的名称，可修改。</p>
        </td>
        </tr>
        <tr id="row152831345485"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p875325925918"><a name="p875325925918"></a><a name="p875325925918"></a>容器规格</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><a name="ul13282205619311"></a><a name="ul13282205619311"></a><ul id="ul13282205619311"><li>Pod的CPU取值范围为0.25核-32核，且CPU必须为0.25核的整数倍</li><li>Pod的内存取值范围为1GB-128GB，且内存必须为1GB的整数倍</li><li>Pod的CPU/内存配比值必须在1:2到1:4之间</li><li>一个Pod内最多支持5个容器，单个容器最小配置是0.25核、0.2GB，最大同容器实例的最大配置。</li></ul>
        </td>
        </tr>
        </tbody>
        </table>

    3.  （可选）高级设置。

        **表 2**  高级设置

        <a name="table17053356320"></a>
        <table><thead align="left"><tr id="row167061935153213"><th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.1.1"><p id="p1370619354321"><a name="p1370619354321"></a><a name="p1370619354321"></a>参数</p>
        </th>
        <th class="cellrowborder" valign="top" width="77%" id="mcps1.2.3.1.2"><p id="p14706113513212"><a name="p14706113513212"></a><a name="p14706113513212"></a>说明</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row135751322144113"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p15172028154119"><a name="p15172028154119"></a><a name="p15172028154119"></a>存储</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p1652162817414"><a name="p1652162817414"></a><a name="p1652162817414"></a>支持挂载持久化卷到容器中，以实现数据文件的持久化存储。当前支持云硬盘卷。</p>
        <a name="ol7523142816416"></a><a name="ol7523142816416"></a><ol id="ol7523142816416"><li>单击<span class="uicontrol" id="uicontrol195306282416"><a name="uicontrol195306282416"></a><a name="uicontrol195306282416"></a>“添加云硬盘卷”</span>。</li><li>输入名称、容量、容器内挂载路径，选择磁盘类型。</li></ol>
        <p id="p125360285419"><a name="p125360285419"></a><a name="p125360285419"></a>负载创建完成后，可对存储卷进行管理，具体请参见<a href="云硬盘卷.md">云硬盘卷</a>。</p>
        </td>
        </tr>
        <tr id="row3669818141715"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p8670718111715"><a name="p8670718111715"></a><a name="p8670718111715"></a>日志采集</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p167031813177"><a name="p167031813177"></a><a name="p167031813177"></a>支持根据您配置的日志输出路径，采集负载日志，并按老化周期（当前固定为1小时）进行防爆处理。</p>
        <a name="ol1888210123245"></a><a name="ol1888210123245"></a><ol id="ol1888210123245"><li>单击添加日志存储。</li><li>输入容器内日志路径，调整日志存储空间。</li></ol>
        <p id="p9370433182511"><a name="p9370433182511"></a><a name="p9370433182511"></a>负载创建完成后，可在AOM界面查看日志，具体请参见<a href="日志管理.md">日志管理</a>。</p>
        </td>
        </tr>
        <tr id="row10165174402214"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p670763593219"><a name="p670763593219"></a><a name="p670763593219"></a>环境变<span>量</span></p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p195601892108"><a name="p195601892108"></a><a name="p195601892108"></a><span>容器运行环境中设定的一个变量。可以在负载部署后修改，为负载提供极大的灵活性。</span></p>
        <a name="ul789917269235"></a><a name="ul789917269235"></a><ul id="ul789917269235"><li>手动输入<a name="ol132614379232"></a><a name="ol132614379232"></a><ol id="ol132614379232"><li>单击<span class="uicontrol" id="uicontrol1412691510249"><a name="uicontrol1412691510249"></a><a name="uicontrol1412691510249"></a>“添加变量”</span>。</li><li>输入变量名称、变量值。</li></ol>
        </li><li>变量引用<a name="ol1160515682420"></a><a name="ol1160515682420"></a><ol id="ol1160515682420"><li>单击添加引用。</li><li>输入变量名称，选择引用类型、引用值。其中Secret引用的创建请参见<a href="使用Secret.md">使用Secret</a>。</li></ol>
        </li></ul>
        </td>
        </tr>
        <tr id="row173162112241"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p4932225132415"><a name="p4932225132415"></a><a name="p4932225132415"></a>健康检查</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p199349253240"><a name="p199349253240"></a><a name="p199349253240"></a>健康检查是指容器运行过程中，根据您需要，定时检查容器健康状况。详细步骤请参见<a href="设置容器健康检查.md">设置容器健康检查</a>。</p>
        </td>
        </tr>
        <tr id="row17061435113218"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p157061235123216"><a name="p157061235123216"></a><a name="p157061235123216"></a>生命周<span>期</span></p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><div class="p" id="p756116916105"><a name="p756116916105"></a><a name="p756116916105"></a><span>生命周期脚本定义，主要针对容器类负载的生命周期事件负载采取的动作。</span>详细步骤请参见<a href="设置容器生命周期.md">设置容器生命周期</a>。<a name="ul7468112919334"></a><a name="ul7468112919334"></a><ul id="ul7468112919334"><li>启动后处<span>理：负载启动后触发。</span></li><li>停止前处理：负载停止前触发。</li></ul>
        </div>
        </td>
        </tr>
        <tr id="row725218519814"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p0252155183"><a name="p0252155183"></a><a name="p0252155183"></a>启动命令</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p1660418369565"><a name="p1660418369565"></a><a name="p1660418369565"></a>输入容器启动命令，容器启动后会立即执行。</p>
        <p id="p14252651281"><a name="p14252651281"></a><a name="p14252651281"></a>启动命令对应于docker的ENTRYPOINT启动命令，详细内容请参见<a href="容器启动命令.md">容器启动命令</a>。</p>
        </td>
        </tr>
        <tr id="row12584143142315"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p10585174311234"><a name="p10585174311234"></a><a name="p10585174311234"></a>ConfigMap</p>
        </td>
        <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p3585443172313"><a name="p3585443172313"></a><a name="p3585443172313"></a>指容器在运行过程中可使用的配置项（ConfigMap）。</p>
        <p id="p1987986123617"><a name="p1987986123617"></a><a name="p1987986123617"></a>单击<span class="uicontrol" id="uicontrol0855185493517"><a name="uicontrol0855185493517"></a><a name="uicontrol0855185493517"></a>“添加ConfigMap”</span>，选择已有配置项。配置项的创建请参见<a href="使用ConfigMap.md">使用ConfigMap</a>。</p>
        </td>
        </tr>
        </tbody>
        </table>

    4.  （可选）一个负载实例包含1个或多个相关容器。若您的负载包含多个容器，请单击“添加容器“，再执行添加容器的操作。

        >![](public_sys-resources/icon-notice.gif) **注意：**   
        >同一个Pod实例中的不同容器如果监听了相同的端口，则会导致端口冲突，Pod可能会启动失败。例如在Pod中添加了一个nginx镜像容器，启动了80端口，如果该Pod中另一个http服务的镜像也启动80端口，那么这个Pod就会出现端口冲突。  


3.  单击“下一步“，根据需要配置Pod数量和域名。

    **表 3**  Pod信息

    <a name="table1611313221310"></a>
    <table><thead align="left"><tr id="row1119173221312"><th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.1.1"><p id="p141211232121313"><a name="p141211232121313"></a><a name="p141211232121313"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="77%" id="mcps1.2.3.1.2"><p id="p1512333241311"><a name="p1512333241311"></a><a name="p1512333241311"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row131241032111318"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p11127103261318"><a name="p11127103261318"></a><a name="p11127103261318"></a>Pod数量</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p4937701143"><a name="p4937701143"></a><a name="p4937701143"></a>负载可以有一个或多个Pod，您可以设置具体Pod个数。每个负载Pod都由相同的容器部署而成。设置多个Pod主要用于实现高可靠性，当某个Pod故障时，负载还能正常运行。</p>
    </td>
    </tr>
    </tbody>
    </table>

4.  单击“下一步“，配置负载信息。

    **表 4**  负载信息

    <a name="table1827691822212"></a>
    <table><thead align="left"><tr id="row4285171810225"><th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.1.1"><p id="p3287201802216"><a name="p3287201802216"></a><a name="p3287201802216"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="77%" id="mcps1.2.3.1.2"><p id="p9290201818226"><a name="p9290201818226"></a><a name="p9290201818226"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row32921418122219"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p47541252112217"><a name="p47541252112217"></a><a name="p47541252112217"></a>负载名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p14102928115915"><a name="p14102928115915"></a><a name="p14102928115915"></a>负载名称。</p>
    <a name="ul350313373019"></a><a name="ul350313373019"></a><ul id="ul350313373019"><li>无状态负载：请输入以小写字母或数字开头，小写字母、数字、中划线（-）、点（.）组成（其中两点不能相连，点不能与中划线相连），小写字母或数字结尾的1到63字符的字符串。</li></ul>
    </td>
    </tr>
    <tr id="row202961188223"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p20956105910229"><a name="p20956105910229"></a><a name="p20956105910229"></a>负载描述</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p2959172813235"><a name="p2959172813235"></a><a name="p2959172813235"></a>描述信息，少于等于250个字符。</p>
    </td>
    </tr>
    <tr id="row530721816224"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p18309101852219"><a name="p18309101852219"></a><a name="p18309101852219"></a>负载访问</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><a name="ul1948183010246"></a><a name="ul1948183010246"></a><ul id="ul1948183010246"><li>不启用：将不提供任何从其他负载访问到当前负载的入口，可用于使用自定义的服务发现或简单启用多个Pod的场景。</li><li>内网访问：内网访问将为当前负载配置一个负载域名或内网域名/虚拟IP，使得当前负载能够为内网中其他负载提供服务，分为 Service 和 ELB 两种方式。内网访问的详细内容请参见<a href="内网访问.md">内网访问</a>。</li><li>公网访问：将提供一个可以从Internet访问的入口，支持HTTP/HTTPS/TCP/UDP协议。公网方法的详细内容请参见<a href="公网访问.md">公网访问</a>。</li></ul>
    </td>
    </tr>
    <tr id="row331241852218"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p4314171818221"><a name="p4314171818221"></a><a name="p4314171818221"></a>负载域名</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p2317111812223"><a name="p2317111812223"></a><a name="p2317111812223"></a>您在云容器实例上运行的其他负载，可以通过该域名访问本负载。负载域名依赖内部域名解析功能，将为您安装功能扩展插件kube-dns。</p>
    <p id="p1591393922619"><a name="p1591393922619"></a><a name="p1591393922619"></a>小写英文字母开头，1-63位，可使用小写英文，数字，中划线（-）。</p>
    </td>
    </tr>
    <tr id="row18993115362610"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p16994653172619"><a name="p16994653172619"></a><a name="p16994653172619"></a>负载端口配置</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p1599418536267"><a name="p1599418536267"></a><a name="p1599418536267"></a>设置负载域名访问端口与容器端口映射关系；负载请求由<span class="uicontrol" id="uicontrol02771842132714"><a name="uicontrol02771842132714"></a><a name="uicontrol02771842132714"></a>“负载域名:访问端口”</span>转发至<span class="uicontrol" id="uicontrol5230651142717"><a name="uicontrol5230651142717"></a><a name="uicontrol5230651142717"></a>“容器实例:容器端口”</span>。</p>
    <a name="ul1968411198280"></a><a name="ul1968411198280"></a><ul id="ul1968411198280"><li>协议：支持TCP/UDP协议。</li><li>负载访问端口：访问负载的端口。</li><li>容器端口：访问容器的端口。</li></ul>
    </td>
    </tr>
    <tr id="row13526175712617"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p652635742617"><a name="p652635742617"></a><a name="p652635742617"></a>ELB实例</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p252611573265"><a name="p252611573265"></a><a name="p252611573265"></a>选择ELB实例，如没有ELB实例请参见<a href="（可选）创建ELB.md">（可选）创建ELB</a>创建。</p>
    </td>
    </tr>
    <tr id="row836195822618"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p83625814262"><a name="p83625814262"></a><a name="p83625814262"></a>ELB协议</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p141241014154317"><a name="p141241014154317"></a><a name="p141241014154317"></a>支持HTTP/HTTPS/TCP/UDP。</p>
    </td>
    </tr>
    <tr id="row13367148134718"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p165702533475"><a name="p165702533475"></a><a name="p165702533475"></a>公网域名</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p12570155384719"><a name="p12570155384719"></a><a name="p12570155384719"></a>将通过该公网域名访问您的负载，不配置时通过ELB IP访问负载；需要您购买公网域名，并将域名解析指向所选ELB实例的IP。</p>
    </td>
    </tr>
    <tr id="row968805715437"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p6688175710438"><a name="p6688175710438"></a><a name="p6688175710438"></a>ELB端口</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p668815704315"><a name="p668815704315"></a><a name="p668815704315"></a>设置ELB访问的端口。</p>
    </td>
    </tr>
    <tr id="row122941029195820"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p13031929165811"><a name="p13031929165811"></a><a name="p13031929165811"></a>证书</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p83031629185814"><a name="p83031629185814"></a><a name="p83031629185814"></a>使用HTTPS协议时需要选择。云容器实例将证书自动安装到弹性负载均衡器上，实现数据传输加密。</p>
    <p id="p517585535912"><a name="p517585535912"></a><a name="p517585535912"></a>SSL证书的导入方法请参见<a href="SSL证书.md">SSL证书</a>。</p>
    </td>
    </tr>
    <tr id="row5431249113714"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p8432204963719"><a name="p8432204963719"></a><a name="p8432204963719"></a>HTTP路由配置</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p94325495371"><a name="p94325495371"></a><a name="p94325495371"></a>设置uri路径到后端负载访问端口的路由关系；公网请求由<span class="uicontrol" id="uicontrol14601122144116"><a name="uicontrol14601122144116"></a><a name="uicontrol14601122144116"></a>“http://公网域名(或elb ip)/映射路径:外部端口”</span>转发至<span class="uicontrol" id="uicontrol94063118414"><a name="uicontrol94063118414"></a><a name="uicontrol94063118414"></a>“负载域名:访问端口”</span>。</p>
    <a name="ul0822177145314"></a><a name="ul0822177145314"></a><ul id="ul0822177145314"><li>映射路径：映射到负载的路径。</li><li>负载访问端口：选择负载访问的端口。</li></ul>
    </td>
    </tr>
    </tbody>
    </table>

5.  配置完成后，单击“提交”，单击“返回工作负载列表”。

    在负载列表中，待负载状态为“运行中“，负载创建成功。您可以单击负载名进入负载详情界面，按F5查看负载实时状态。

    若需要访问负载，选择“访问配置“Tab页，查看访问地址。


