# 升级负载<a name="cci_01_0014"></a>

负载创建成功后，可以对负载更新和升级。

目前支持滚动升级，滚动升级将逐步用新版本的负载替换旧版本的负载，升级的过程中，业务流量会同时负载均衡分布到新老的负载上，因此业务不会中断。

## 升级负载<a name="section943219520274"></a>

1.  登录云容器实例管理控制台，单击要更新升级的负载，进入实例详情页面，单击右上角“升级“。
2.  修改Pod规格。

    您可以选择使用GPU（只能在GPU型命名空间下）或不使用GPU。

    当前提供Nvidia Telsla V100 16G显卡（显卡驱动版本: 396.26 | CUDA驱动版本: 9.2），使用GPU时容器规格有如下几种：

    -   Nvidia Telsla V100 16G x 1，CPU 4核，内存32GB
    -   Nvidia Telsla V100 16G x 2，CPU 8核，内存64GB
    -   Nvidia Telsla V100 16G x 4，CPU 16核，内存128GB
    -   Nvidia Telsla V100 16G x 8，CPU 32核，内存256GB

    不使用GPU时容器规格有如下几种：

    -   Pod的CPU取值范围为0.25核-32核，且单个容器的CPU必须为0.25核的整数倍
    -   Pod的内存取值范围为1GB-128GB，且内存必须为1GB的整数倍
    -   Pod的CPU/内存配比值必须在1:2到1:4之间
    -   一个Pod内最多支持5个容器，单个容器最小配置是0.25核、0.2GB，最大同容器实例的最大配置

3.  修改容器配置。
    1.  单击“更换镜像“可以选择新的镜像，如下图所示。

        **图 1**  更换镜像<a name="fig2850632192810"></a>  
        ![](figures/更换镜像.png "更换镜像")

        -   我的镜像：展示了您上传到容器镜像服务的镜像。
        -   Docker官方镜像：展示了Dockerhub上的公共镜像。
        -   共享镜像：展示了容器镜像服务中他人共享的镜像。

    2.  镜像选择完成后，需要选择镜像的版本、设置容器名称、设置容器占用的CPU和内存规格（单个容器最小配置是0.25核、0.2GB）。

        对于Pod中只有一个容器能使用GPU，如果您的Pod中有个多个容器，您可以通过“开启GPU“这个开关选择哪个容器使用GPU。

        您还可以为容器做如下高级设置：

        -   存储：支持挂载持久化卷到容器中，以实现数据文件的持久化存储，当前支持云硬盘卷、文件存储卷和极速文件存储卷。单击“添加云硬盘卷“、“添加文件存储卷“或“添加极速文件存储卷“，输入名称、容量、容器内挂载路径，选择磁盘类型。负载创建完成后，可对存储卷进行管理，具体请参见[云硬盘卷](云硬盘卷.md)、[文件存储卷](文件存储卷.md)或[极速文件存储卷](极速文件存储卷.md)。
        -   日志采集：支持根据您配置的日志输出路径，采集负载日志，并进行防爆处理。单击添加日志存储，输入容器内日志路径，调整日志存储空间。负载创建完成后，可在AOM界面查看日志，具体请参见[日志管理](日志管理.md)。
        -   环境变量：在容器中设置环境变量，支持手动输入和引用变量。环境变量为应用提供极大的灵活性，您可以在应用程序中使用环境变量，在创建容器时为环境变量赋值，容器运行时读取环境变量的值，从而做到灵活的配置，而不是每次都重新编写应用程序制作镜像。

            手动输入只需要直接输入变量名称和变量值。

            变量引用支持引用PodIP（Pod的IP地址）、PodName（Pod的名称）以及Secret，输入变量名称，选择引用类型、引用值。其中Secret引用的创建请参见[使用Secret](使用Secret.md)。

        -   健康检查：健康检查是指容器运行过程中，根据您需要，定时检查容器健康状况。详细步骤请参见[健康检查](健康检查.md)。
        -   生命周期：生命周期脚本定义，主要针对容器类负载的生命周期事件负载采取的动作。详细步骤请参见[容器生命周期](容器生命周期.md)。
        -   启动命令：输入容器启动命令，容器启动后会立即执行。启动命令对应于docker的ENTRYPOINT启动命令，详细内容请参见[容器启动命令](容器启动命令.md)。
        -   配置管理：容器支持挂载ConfigMap和Secret。ConfigMap和Secret的创建请参见[使用ConfigMap](使用ConfigMap.md)和[使用Secret](使用Secret.md)。


4.  单击“下一步“。
5.  单击“提交“，升级负载。

## 使用kubectl升级负载<a name="section1244711734015"></a>

使用kubectl升级负载请参见[Deployment](https://support.huaweicloud.com/devg-cci/cci_05_0005.html)章节的“升级“部分。

